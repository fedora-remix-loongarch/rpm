From 1b34b839b788264ffcd3ab90a0612cad3b843f7f Mon Sep 17 00:00:00 2001
From: Igor Gnatenko <i.gnatenko.brain@gmail.com>
Date: Wed, 10 Aug 2016 13:58:30 +0200
Subject: [PATCH] configure.ac: use LIBDW always conditionally

References: https://bugzilla.redhat.com/show_bug.cgi?id=1365278
Reported-and-tested-by: Neal Gompa <ngompa13@gmail.com>
Signed-off-by: Igor Gnatenko <i.gnatenko.brain@gmail.com>

(cherry picked from commit a82119bf352400ee891105820b804bf946d5c6ee)
---
 configure.ac | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index 8890c3c32..33c8f344f 100644
--- a/configure.ac
+++ b/configure.ac
@@ -361,7 +361,8 @@ AM_CONDITIONAL(WITH_ARCHIVE,[test "$with_archive" = yes])
 
 #=================
 # Check for elfutils libdw library with dwelf_elf_gnu_build_id.
-AS_IF([test "$WITH_LIBELF" = yes],[
+WITH_LIBDW_LIB=
+AS_IF([test "$WITH_LIBELF" != yes],[
   AC_CHECK_HEADERS([elfutils/libdwelf.h],[
     AC_CHECK_LIB(dw, dwelf_elf_gnu_build_id, [
       AC_DEFINE(HAVE_LIBDW, 1,
@@ -370,9 +371,9 @@ AS_IF([test "$WITH_LIBELF" = yes],[
       WITH_LIBDW=yes
     ])
   ])
-  AC_SUBST(WITH_LIBDW_LIB)
-  AM_CONDITIONAL(LIBDW,[test "$WITH_LIBDW" = yes])
 ])
+AC_SUBST(WITH_LIBDW_LIB)
+AM_CONDITIONAL(LIBDW,[test "$WITH_LIBDW" = yes])
 
 #=================
 # Process --with/without-external-db
